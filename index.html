<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM > STATUS</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
</head>
<body>

    <div class="system-container">
        <div class="header">
            <h1>STATUS</h1>
            <span class="rank" style="color:gold">GOLD: <span id="gold-val">0</span></span>
        </div>
        
        <div class="divider"></div>

        <div class="stats-grid">
            <div class="stat-row">
                <span class="label">NAME:</span>
                <span class="value">PLAYER</span>
            </div>
            <div class="stat-row">
                <span class="label">LEVEL:</span>
                <span class="value" id="level-val">1</span>
            </div>
             <div class="stat-row">
                <span class="label">JOB:</span>
                <span class="value">RED TEAMER</span>
            </div>
        </div>

        <div class="attributes">
            <div class="stat-control">
                <span class="stat-name">STRENGTH</span> <span class="stat-num" id="str-val">10</span>
            </div>
            <div class="stat-control">
                <span class="stat-name">INTELLECT</span> <span class="stat-num" id="int-val">10</span>
            </div>
            <div class="stat-control">
                <span class="stat-name">SENSE</span> <span class="stat-num" id="sen-val">10</span>
            </div>
        </div>

        <div class="divider"></div>

        <div class="header">
            <h1>DAILY QUESTS</h1>
        </div>

        <div class="quest-container">
            <div class="quest-item">
                <span>PUSH-UPS (STR)</span>
                <div class="progress-box">
                    <span id="pushups-count">0</span> / 100
                    <button class="add-btn" onclick="doAction('pushups', 10, 'strength')">+10</button>
                </div>
            </div>

            <div class="quest-item">
                <span>DEEP WORK (INT)</span> <div class="progress-box">
                    <span id="study-count">0</span> / 4 hrs
                    <button class="add-btn" onclick="doAction('study', 1, 'intellect')">+1 hr</button>
                </div>
            </div>

            <div class="quest-item">
                <span>MEDITATION (SEN)</span> <div class="progress-box">
                    <span id="meditate-count">0</span> / 3
                    <button class="add-btn" onclick="doAction('meditate', 1, 'sense')">+10m</button>
                </div>
            </div>
        </div>
        
        <div class="divider"></div>
        
        <div class="header">
            <h1>REWARDS</h1>
        </div>
        <div class="quest-container">
            <div class="quest-item">
                <span>1 HR GAMING</span>
                <button class="add-btn" onclick="buyItem(50)">BUY (50G)</button>
            </div>
        </div>

        <div class="notification" id="alert-box">
            [ UPDATE COMPLETE ]
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // ======================================================
        // ⚠️ PASTE YOUR CONFIG HERE (Copy from your old file) ⚠️
        // ======================================================
        const firebaseConfig = {
            apiKey: "AIzaSyDrgsTDxEfFU9UBqj2ua3JAI8pzdgTVz2U####", 
            authDomain: "sololevelingsystem-b2712.firebaseapp.com",
            databaseURL: "https://sololevelingsystem-b2712-default-rtdb.firebaseio.com", 
            projectId: "sololevelingsystem-b2712",
            storageBucket: "sololevelingsystem-b2712.firebasestorage.app",
            messagingSenderId: "128628540730",
            appId: "1:128628540730:web:eede6b7b8afc9b00d1fc03"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const userRef = ref(db, 'hunters/jin_woo');

        // LISTEN TO DATA (With 'undefined' protection)
        onValue(userRef, (snapshot) => {
            const data = snapshot.val() || {};
            
            // Safety: If stats/quests are missing, use empty objects {}
            const stats = data.stats || {};
            const quests = data.daily_quest || {};

            // Update UI (The "|| 0" part fixes the "undefined" error)
            document.getElementById('str-val').innerText = stats.strength || 10;
            document.getElementById('int-val').innerText = stats.intellect || 10;
            document.getElementById('sen-val').innerText = stats.sense || 10;
            document.getElementById('gold-val').innerText = stats.gold || 0;
            document.getElementById('level-val').innerText = stats.level || 1;

            document.getElementById('pushups-count').innerText = quests.pushups || 0;
            document.getElementById('study-count').innerText = quests.study || 0;
            document.getElementById('meditate-count').innerText = quests.meditate || 0;
        });

        // UNIFIED ACTION FUNCTION
        window.doAction = function(questType, amount, statType) {
            // Get current local values
            const currentQuestVal = parseInt(document.getElementById(questType + '-count').innerText);
            // Fix: Handle cases where stat value might be 'undefined' or NaN
            let statElem = document.getElementById(statType.substring(0,3) + '-val');
            let currentStatVal = parseInt(statElem.innerText) || 0;
            let currentGold = parseInt(document.getElementById('gold-val').innerText) || 0;
            
            // Limits
            let limit = (questType === 'pushups') ? 100 : (questType === 'study') ? 4 : 3;
            if (currentQuestVal >= limit) return;

            const updates = {};
            
            // 1. Update Quest Progress
            updates['daily_quest/' + questType] = currentQuestVal + amount;
            
            // 2. Auto-Update Stat
            updates['stats/' + statType] = currentStatVal + 1;

            // 3. Give Gold Reward (1 click = 10 Gold)
            updates['stats/gold'] = currentGold + 10;

            update(userRef, updates);
            triggerAlert(statType.toUpperCase() + " INCREASED");
        }

        window.buyItem = function(cost) {
            const currentGold = parseInt(document.getElementById('gold-val').innerText) || 0;
            if (currentGold >= cost) {
                update(userRef, { 'stats/gold': currentGold - cost });
                triggerAlert("ITEM PURCHASED");
            } else {
                triggerAlert("NOT ENOUGH GOLD");
            }
        }

        function triggerAlert(msg) {
            const alertBox = document.getElementById('alert-box');
            alertBox.innerText = "[ " + msg + " ]";
            alertBox.style.opacity = '1';
            setTimeout(() => { alertBox.style.opacity = '0'; }, 2000);
        }
    </script>
</body>
</html>