<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTEM > STATUS</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
</head>
<body>

    <audio id="sfx-click" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.m4a"></audio>
    <audio id="sfx-levelup" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.m4a"></audio>
    <audio id="sfx-buy" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.m4a"></audio>

    <div class="system-container">
        <div class="header">
            <h1>STATUS</h1>
            <span class="rank" style="color:gold">GOLD: <span id="gold-val">0</span></span>
        </div>
        
        <div class="divider"></div>

        <div class="stats-grid">
            <div class="stat-row">
                <span class="label">NAME:</span>
                <span class="value">PLAYER</span>
            </div>
            <div class="stat-row">
                <span class="label">LEVEL:</span>
                <span class="value" id="level-val">1</span>
            </div>
             <div class="stat-row">
                <span class="label">JOB:</span>
                <span class="value" id="job-val" style="color: #888;">NONE</span>
            </div>
            <div class="stat-row">
                <span class="label">RANK:</span>
                <span class="value" id="rank-val" style="color: #fff;">E-RANK</span>
            </div>
            
            <div class="xp-container" style="grid-column: span 2; margin-top: 5px;">
                <div style="display:flex; justify-content:space-between; font-size: 10px; color: #888;">
                    <span>XP</span>
                    <span id="xp-text">0 / 100</span>
                </div>
                <div class="xp-bar-bg">
                    <div id="xp-fill" class="xp-bar-fill"></div>
                </div>
            </div>
        </div>

        <div class="divider"></div>

        <div class="attributes">
            <div class="stat-control">
                <span class="stat-name">STRENGTH</span>
                <span class="stat-num" id="str-val">10</span>
            </div>
            <div class="stat-control">
                <span class="stat-name">INTELLECT</span>
                <span class="stat-num" id="int-val">10</span>
            </div>
            <div class="stat-control">
                <span class="stat-name">SENSE</span>
                <span class="stat-num" id="sen-val">10</span>
            </div>
        </div>

        <div class="divider"></div>

        <div class="header">
            <h1>DAILY QUESTS</h1>
        </div>

        <div class="quest-container">
            <div class="quest-item">
                <span>PUSH-UPS (STR)</span>
                <div class="progress-box">
                    <span id="pushups-count">0</span> / 100
                    <button class="add-btn" onclick="doAction('pushups', 10, 'strength')">+10</button>
                </div>
            </div>

            <div class="quest-item">
                <span>DEEP WORK (INT)</span>
                <div class="progress-box">
                    <span id="study-count">0</span> / 4 hrs
                    <button class="add-btn" onclick="doAction('study', 1, 'intellect')">+1 hr</button>
                </div>
            </div>

            <div class="quest-item">
                <span>MEDITATION (SEN)</span>
                <div class="progress-box">
                    <span id="meditate-count">0</span> / 3
                    <button class="add-btn" onclick="doAction('meditate', 1, 'sense')">+10m</button>
                </div>
            </div>
        </div>
        
        <div class="divider"></div>
        
        <div class="header">
            <h1>REWARDS</h1>
        </div>
        <div class="quest-container">
            <div class="quest-item">
                <span>1 HR GAMING</span>
                <button class="add-btn" onclick="buyItem(50)">BUY (50G)</button>
            </div>
            <div class="quest-item">
                <span>CHEAT MEAL</span>
                <button class="add-btn" onclick="buyItem(100)">BUY (100G)</button>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px; opacity: 0.5;">
            <button onclick="manualReset()" style="border: 1px solid #ff4444; color: #ff4444; background: transparent; padding: 5px; cursor: pointer; font-family: 'Orbitron', sans-serif;">
                [ SYSTEM REBOOT ]
            </button>
        </div>

        <div class="notification" id="alert-box">
            [ UPDATE COMPLETE ]
        </div>
    </div>

    <div id="emergency-overlay" class="emergency-box" style="display: none;">
        <div class="emergency-header">
            ⚠ EMERGENCY QUEST ⚠
        </div>
        <div class="emergency-content">
            <p id="emergency-task">SURVIVE UNTIL MIDNIGHT</p>
            <div class="emergency-rewards">
                REWARD: <span style="color: gold">+1000 GOLD</span><br>
                PENALTY: <span style="color: red">-50 XP</span>
            </div>
            <div class="emergency-actions">
                <button class="emergency-btn success" onclick="completeEmergency(true)">COMPLETE</button>
                <button class="emergency-btn fail" onclick="completeEmergency(false)">FAIL (PENALTY)</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, onValue, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // ============================================
        // ⚠️ PASTE YOUR FIREBASE CONFIG HERE ⚠️
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyDrgsTDxEfFU9UBqj2ua3JAI8pzdgTVz2U####", 
            authDomain: "sololevelingsystem-b2712.firebaseapp.com",
            databaseURL: "https://sololevelingsystem-b2712-default-rtdb.firebaseio.com", 
            projectId: "sololevelingsystem-b2712",
            storageBucket: "sololevelingsystem-b2712.firebasestorage.app",
            messagingSenderId: "128628540730",
            appId: "1:128628540730:web:eede6b7b8afc9b00d1fc03"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const userRef = ref(db, 'hunters/jin_woo');

        const RANDOM_QUESTS = [
            "DO 50 BURPEES NOW",
            "COLD SHOWER (3 MINS)",
            "SPRINT 1 KM",
            "NO SOCIAL MEDIA FOR 24 HRS",
            "READ 20 PAGES OF A BOOK",
            "CLEAN YOUR ROOM"
        ];

        // 1. LISTEN TO DATA
        onValue(userRef, (snapshot) => {
            const data = snapshot.val() || {};
            const stats = data.stats || {};
            const quests = data.daily_quest || {};
            const emergency = data.emergency || { active: false, task: "" };

            // Basic Stats
            let level = stats.level || 1;
            let currentXP = stats.xp || 0;
            let maxXP = level * 100;

            // --- RANK LOGIC ---
            let rank = "E-RANK";
            let rankColor = "#fff";
            if (level >= 10) { rank = "D-RANK"; rankColor = "#00ff00"; }
            if (level >= 20) { rank = "C-RANK"; rankColor = "#00aaff"; }
            if (level >= 40) { rank = "B-RANK"; rankColor = "#ffaa00"; }
            if (level >= 70) { rank = "A-RANK"; rankColor = "#ff0000"; }
            if (level >= 100) { rank = "S-RANK"; rankColor = "#d400ff"; }

            // --- JOB EVOLUTION LOGIC (NEW) ---
            let jobTitle = "NONE";
            let jobColor = "#888"; 
            if (level >= 10) { jobTitle = "GHOST OPERATOR"; jobColor = "#00ff99"; } 
            if (level >= 25) { jobTitle = "PHANTOM BREAKER"; jobColor = "#00ccff"; } 
            if (level >= 50) { jobTitle = "VOID WALKER"; jobColor = "#d400ff"; } 
            if (level >= 75) { jobTitle = "ROOT DESTROYER"; jobColor = "#ff0055"; } 
            if (level >= 100) { jobTitle = "DISASTER CLASS"; jobColor = "#ff0000"; } 

            // Update UI
            document.getElementById('str-val').innerText = stats.strength || 10;
            document.getElementById('int-val').innerText = stats.intellect || 10;
            document.getElementById('sen-val').innerText = stats.sense || 10;
            document.getElementById('gold-val').innerText = stats.gold || 0;
            document.getElementById('level-val').innerText = level;

            // Update Rank
            const rankElem = document.getElementById('rank-val');
            rankElem.innerText = rank;
            rankElem.style.color = rankColor;
            rankElem.style.textShadow = `0 0 10px ${rankColor}`;

            // Update Job
            const jobElem = document.getElementById('job-val');
            jobElem.innerText = jobTitle;
            jobElem.style.color = jobColor;
            if(level >= 50) jobElem.style.textShadow = `0 0 10px ${jobColor}`;

            document.getElementById('pushups-count').innerText = quests.pushups || 0;
            document.getElementById('study-count').innerText = quests.study || 0;
            document.getElementById('meditate-count').innerText = quests.meditate || 0;

            // XP Bar
            let xpPercent = (currentXP / maxXP) * 100;
            if(xpPercent > 100) xpPercent = 100;
            document.getElementById('xp-fill').style.width = xpPercent + "%";
            document.getElementById('xp-text').innerText = `${currentXP} / ${maxXP}`;

            // Emergency Overlay
            const emergencyBox = document.getElementById('emergency-overlay');
            if (emergency.active) {
                emergencyBox.style.display = 'block';
                document.getElementById('emergency-task').innerText = emergency.task;
                document.querySelector('.system-container').style.filter = "blur(5px)";
            } else {
                emergencyBox.style.display = 'none';
                document.querySelector('.system-container').style.filter = "none";
            }
        });

        // 2. ACTION HANDLER
        window.doAction = function(questType, amount, statType) {
            playSound('click');
            const currentQuestVal = parseInt(document.getElementById(questType + '-count').innerText);
            let statElem = document.getElementById(statType.substring(0,3) + '-val');
            let currentStatVal = parseInt(statElem.innerText) || 0;
            let currentGold = parseInt(document.getElementById('gold-val').innerText) || 0;
            
            let level = parseInt(document.getElementById('level-val').innerText) || 1;
            let xpText = document.getElementById('xp-text').innerText.split(' / ');
            let currentXP = parseInt(xpText[0]) || 0;
            let maxXP = parseInt(xpText[1]) || 100;

            let limit = (questType === 'pushups') ? 100 : (questType === 'study') ? 4 : 3;
            if (currentQuestVal >= limit) return;

            const updates = {};
            updates['daily_quest/' + questType] = currentQuestVal + amount;
            updates['stats/' + statType] = currentStatVal + 1;
            updates['stats/gold'] = currentGold + 10;

            let newXP = currentXP + 10;
            if (newXP >= maxXP) {
                let newLevel = level + 1;
                let leftoverXP = newXP - maxXP;
                updates['stats/level'] = newLevel;
                updates['stats/xp'] = leftoverXP;
                updates['stats/gold'] = currentGold + 500;
                playSound('levelup');
                triggerAlert("LEVEL UP! YOU ARE NOW LEVEL " + newLevel);
            } else {
                updates['stats/xp'] = newXP;
                triggerAlert(statType.toUpperCase() + " INCREASED");
            }

            // 5% Chance of Emergency Quest
            if (Math.random() < 0.05) {
                const randomTask = RANDOM_QUESTS[Math.floor(Math.random() * RANDOM_QUESTS.length)];
                updates['emergency/active'] = true;
                updates['emergency/task'] = randomTask;
                triggerAlert("⚠ ANOMALY DETECTED ⚠");
                playSound('levelup');
            }

            update(userRef, updates);
        }

        // 3. SHOP HANDLER
        window.buyItem = function(cost) {
            const currentGold = parseInt(document.getElementById('gold-val').innerText) || 0;
            if (currentGold >= cost) {
                update(userRef, { 'stats/gold': currentGold - cost });
                playSound('buy');
                triggerAlert("ITEM PURCHASED");
            } else {
                triggerAlert("NOT ENOUGH GOLD");
            }
        }

        // 4. EMERGENCY HANDLER
        window.completeEmergency = function(success) {
            const updates = {};
            updates['emergency/active'] = false;
            let currentGold = parseInt(document.getElementById('gold-val').innerText) || 0;
            let xpText = document.getElementById('xp-text').innerText.split(' / ');
            let currentXP = parseInt(xpText[0]) || 0;

            if (success) {
                updates['stats/gold'] = currentGold + 1000;
                updates['stats/xp'] = currentXP + 50;
                triggerAlert("EMERGENCY CLEARED: +1000G");
                playSound('levelup');
            } else {
                let newXP = currentXP - 50;
                if (newXP < 0) newXP = 0;
                updates['stats/xp'] = newXP;
                triggerAlert("PENALTY APPLIED: -50 XP");
            }
            update(userRef, updates);
        }

        // 5. MANUAL RESET
        window.manualReset = function() {
            if(confirm("Start a New Day? (Resets Daily Quests)")) {
                const updates = {};
                updates['daily_quest/pushups'] = 0;
                updates['daily_quest/study'] = 0;
                updates['daily_quest/meditate'] = 0;
                update(userRef, updates);
                triggerAlert("SYSTEM RESET COMPLETE");
            }
        }

        function playSound(type) {
            const audio = document.getElementById('sfx-' + type);
            if(audio) {
                audio.currentTime = 0;
                audio.play().catch(e => console.log("Audio play failed")); 
            }
        }

        function triggerAlert(msg) {
            const alertBox = document.getElementById('alert-box');
            alertBox.innerText = "[ " + msg + " ]";
            alertBox.style.opacity = '1';
            setTimeout(() => { alertBox.style.opacity = '0'; }, 2000);
        }
    </script>
</body>
</html>
